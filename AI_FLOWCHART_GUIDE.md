# AI 流程图生成功能使用指南

## 简介

XPMN Explorer 集成了强大的 AI 助手功能，AI 可以像真正的设计师一样，**直接在编辑器上绘制流程图**，而不是生成代码。基于 Gemini 3 Pro 模型，AI 助手通过自然语言理解您的需求，然后亲自动手在画布上创建节点、连接线条，完成整个流程图的绘制。

## 核心特性

- 🎨 **AI 直接绘制**：AI 像人类设计师一样操作编辑器，创建节点、连线
- 💬 **自然语言交互**：只需用文字描述，无需学习复杂的语法
- ⚡ **实时可见**：看着 AI 一步步在画布上画出流程图
- 🔧 **智能修改**：AI 可以理解现有流程，进行精准的增删改
- 🧠 **上下文感知**：AI 记住当前流程结构，支持连续对话
- 🎯 **多种节点类型**：支持开始、结束、任务、网关等所有 BPMN 节点

## 快速开始

### 1. 打开 AI 助手

点击页面右下角的客服图标 👤，打开聊天对话框。

### 2. 描述您的流程

在对话框中输入流程描述，按 Enter 发送。

## 使用示例

### 示例 1：创建简单流程

**输入：**
```
创建一个简单的请假流程，包括提交申请、经理审批、结束
```

**效果：**
AI 会生成一个包含以下节点的流程图：
- 开始节点
- 用户任务：提交请假申请
- 用户任务：经理审批
- 结束节点

### 示例 2：带条件判断的流程

**输入：**
```
创建一个报销审批流程：
1. 员工提交报销申请
2. 经理审批
3. 如果金额小于1000元，直接通过
4. 如果金额大于等于1000元，需要财务总监审批
5. 审批通过后结束
```

**效果：**
AI 会生成包含排他网关的流程图，根据金额条件分支处理。

### 示例 3：并行流程

**输入：**
```
创建一个新员工入职流程：
1. HR 创建员工档案
2. 同时进行三个并行任务：
   - IT 部门配置账号
   - 行政部门准备工位
   - 财务部门录入薪资信息
3. 所有任务完成后，发送入职欢迎邮件
4. 流程结束
```

**效果：**
AI 会生成包含并行网关的流程图，支持多任务并行处理。

### 示例 4：复杂业务流程

**输入：**
```
创建一个完整的用户注册流程：
1. 用户填写注册信息
2. 系统调用手机验证服务
3. 验证成功后进入实名认证
4. 提交身份证照片
5. 系统调用实名认证服务
6. 如果认证通过，完成注册
7. 如果认证失败，返回修改信息，重新提交
```

**效果：**
AI 会生成包含用户任务、服务任务、排他网关的完整流程图。

### 示例 5：修改现有流程

**前提条件：** 编辑器中已有流程图

**输入：**
```
在当前流程图的经理审批后面添加一个 HR 审核节点
```

**效果：**
AI 会基于当前流程图，在指定位置插入新节点，保持原有结构。

### 示例 6：优化流程

**输入：**
```
请优化当前流程图，在提交申请和审批之间增加一个自动校验环节
```

**效果：**
AI 会分析当前流程，在合适位置插入服务任务节点。

## 支持的节点类型

### 1. 开始节点 (startNode)
流程的起始点，每个流程必须有一个开始节点。

**示例描述：**
- "从开始节点开始"
- "流程开始"

### 2. 结束节点 (endNode)
流程的终止点，可以有多个结束节点。

**示例描述：**
- "流程结束"
- "结束流程"

### 3. 用户任务 (userNode)
需要人工参与完成的任务，通常关联一个页面或表单。

**示例描述：**
- "用户填写申请表单"
- "经理进行审批"
- "HR 审核信息"

### 4. 服务任务 (serviceNode)
由系统自动执行的服务调用，不需要人工干预。

**示例描述：**
- "系统调用验证服务"
- "自动发送通知邮件"
- "调用支付接口"

### 5. 排他网关 (exclusiveGateway)
根据条件选择一条路径执行，实现分支逻辑。

**示例描述：**
- "如果金额大于1000元，则..."
- "根据审批结果判断"
- "检查用户类型，分别处理"

### 6. 并行网关 (parallelGateway)
用于并行分支和合并，多个任务同时执行。

**示例描述：**
- "同时进行三个任务"
- "并行处理"
- "等待所有分支完成"

### 7. 业务节点 (businessNode)
复合节点，可以包含子流程。

**示例描述：**
- "实名认证子流程"
- "支付处理业务节点"

## 关键词触发

以下关键词会触发 AI 进入流程图生成模式：

- 流程、流程图
- 画、创建、生成
- 添加、修改
- XPMN、BPMN
- 节点、开始、结束、任务

**建议：** 在描述中明确使用"创建流程"、"生成流程图"等词语，确保 AI 正确识别意图。

## 最佳实践

### 1. 清晰描述流程步骤

**推荐：**
```
创建一个采购流程：
1. 提交采购申请
2. 部门经理审批
3. 采购部门处理
4. 财务付款
5. 完成
```

**不推荐：**
```
做一个采购的东西
```

### 2. 明确条件分支

**推荐：**
```
如果金额小于1000元，直接通过；
如果金额大于等于1000元，需要总监审批
```

**不推荐：**
```
根据金额不同处理
```

### 3. 指定任务类型

**推荐：**
```
用户填写表单（用户任务）
系统自动发送邮件（服务任务）
```

**不推荐：**
```
填写表单
发送邮件
```

### 4. 分步描述复杂流程

对于复杂流程，建议：
1. 先创建主流程框架
2. 再逐步添加细节和分支
3. 最后优化和调整

## 提示与技巧

### 技巧 1：使用序号组织流程

使用 1、2、3 等序号可以帮助 AI 更好地理解流程顺序。

### 技巧 2：明确角色和职责

在描述中指明"经理审批"、"HR 处理"等，AI 会自动设置任务的执行者。

### 技巧 3：描述异常分支

不要忘记描述失败、拒绝等异常情况的处理流程。

### 技巧 4：使用业务术语

使用行业标准术语，如"工单"、"审批"、"驳回"等，AI 能更准确理解。

### 技巧 5：参考现有流程

如果要修改流程，先用"查看当前流程"了解结构，再提出修改建议。

## 普通对话功能

AI 助手不仅能生成流程图，还支持普通对话：

**示例：**
```
你：什么是 XPMN？
AI：XPMN（eXtended Process Model and Notation）是一种扩展的流程建模标记语言...

你：如何使用排他网关？
AI：排他网关用于根据条件选择一条路径执行...
```

当没有流程图相关关键词时，AI 会自动切换到普通对话模式。

## 常见问题

### Q1: AI 没有生成流程图，只返回了文字？

**原因：** 消息中缺少流程图相关关键词。

**解决：** 在描述中加入"创建流程图"、"生成流程"等明确的关键词。

### Q2: 生成的流程图与描述不符？

**原因：** 描述可能不够清晰或存在歧义。

**解决：**
1. 使用更具体、更结构化的描述
2. 分步骤详细说明
3. 明确节点类型和连接关系

### Q3: 如何修改生成的流程图？

**方法 1：** 在对话框中继续描述修改需求，AI 会基于当前流程图进行修改。

**方法 2：** 使用编辑器的可视化编辑功能直接修改。

### Q4: 生成失败，显示错误信息？

**可能原因：**
1. API 调用失败（网络问题）
2. 生成的 XPMN 格式不正确
3. 格式转换失败

**解决：**
1. 检查网络连接
2. 查看错误信息，重新描述流程
3. 简化流程描述，分步生成

### Q5: 支持哪些复杂的流程模式？

目前支持：
- ✅ 顺序流程
- ✅ 条件分支（排他网关）
- ✅ 并行处理（并行网关）
- ✅ 子流程（业务节点）
- ✅ 循环和回退
- ✅ 事件触发

## 技术说明

### API 配置

- **API 地址**: `https://api.aicodewith.com/api`
- **模型**: `gemini-3-pro-preview`
- **格式**: Gemini 原生 API 格式

### 流程图格式

- **输入格式**: 自然语言描述
- **中间格式**: XPMN XML
- **显示格式**: BPMN 2.0
- **存储**: 本地 localStorage

### 工作流程

1. 用户输入 → 2. 关键词检测 → 3. 构建提示词 → 4. 调用 LLM API → 5. 提取 XPMN XML → 6. 转换为 BPMN → 7. 加载到编辑器 → 8. 显示成功

## 技术实现

### Function Calling (工具调用)

AI 助手使用 Gemini API 的 Function Calling 功能，可以直接调用以下编辑器操作工具：

1. **createNode** - 创建节点
2. **createFlow** - 创建连线
3. **deleteNode** - 删除节点
4. **updateNode** - 更新节点
5. **clearCanvas** - 清空画布
6. **getNodes** - 查看节点列表

### 工作原理

```
用户输入 → AI 理解需求 → 调用工具函数 → 直接操作编辑器 → 实时显示结果
```

### 与代码生成的区别

**传统方式**（已弃用）：
- 用户描述 → AI 生成 XML 代码 → 解析代码 → 渲染流程图
- 用户看到的是代码，而不是绘图过程

**新方式**（当前）：
- 用户描述 → AI 直接操作编辑器 → 实时绘制流程图
- 用户看到的是 AI 在画图，就像真人操作一样

## 更新日志

### v2.0.0 (2025-12-10)
- 🎨 **重大更新**：AI 现在直接操作编辑器绘制流程图
- ✨ 集成 Function Calling，支持工具调用
- ✨ 实时可见的绘图过程
- ✨ 更自然的交互体验
- 🔧 支持复杂的多步骤操作
- 🚀 性能优化，响应更快

### v1.0.0 (2025-12-10)
- ✨ 初始版本发布
- ✨ 支持基于自然语言的流程图生成（XML 方式）
- ✨ 支持流程图修改和优化
- ✨ 集成 Gemini 3 Pro 模型
- ✨ 完整的 XPMN 系统提示词
- ✨ 智能关键词检测
- ✨ 自动格式转换

## 反馈与支持

如果您在使用过程中遇到问题或有改进建议，请通过以下方式联系：

- GitHub Issues: [项目地址]
- 邮箱: [联系邮箱]

---

**开始使用 AI 助手，让流程图设计更简单！** 🚀
