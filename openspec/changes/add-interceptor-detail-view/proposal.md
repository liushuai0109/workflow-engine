# 变更:添加拦截器详情视图

## 为什么

当前 Mock 控制面板已经实现了拦截器调用列表的基本展示,但存在以下问题:

1. **列表视觉密度不够优化**:虽然已有拦截器列表展示,但在演示场景中需要更清晰的视觉层次和信息组织
   - 当前的拦截器项目包含序号、名称、时间戳和模式切换控件,但视觉引导不够明显
   - 列表项的交互反馈(hover、active 状态)已实现,但在演示中需要强化

2. **详情展示已实现但需验证完整性**:
   - 当前实现使用分屏布局(split-panel),上半部分显示拦截器列表,下半部分显示详情
   - 详情部分已有 Tabs 切换(入参 tab、回包 tab),使用 `a-tabs` 组件
   - 入参和回包都以 JSON 格式在 textarea 中展示
   - 需要验证该实现是否完全满足演示需求

3. **演示用例准备不足**:
   - 需要有示例数据展示拦截器列表和详情的完整功能
   - 需要验证在真实工作流执行时的数据流和 UI 更新

## 目标

本次变更旨在为演示目的优化和完善 Mock 面板中的拦截器详情视图:

1. **优化列表 UI**:
   - 增强列表项的视觉设计,使其更适合演示场景
   - 保持现有功能(序号徽章、名称、时间戳、模式切换)
   - 优化交互反馈和状态指示

2. **完善详情视图**:
   - 验证当前 Tabs 实现是否完整支持入参和回包展示
   - 确保 JSON 格式化清晰易读
   - 优化空状态提示

3. **创建演示用例**:
   - 准备示例工作流和执行场景
   - 验证拦截器数据在 UI 中的完整展示流程

## 当前实现状态

根据 `MockControlPanel.vue` 分析:

**已实现功能**:
- ✅ 拦截器列表渲染 (lines 72-96)
  - 显示序号徽章 (`interceptor-order`)
  - 显示拦截器名称 (`interceptor-name`)
  - 显示时间戳 (`interceptor-time`)
  - 模式切换控件 (记录/Mock/禁用)
  - 点击选中效果 (`active` class)

- ✅ 拦截器详情展示 (lines 103-133)
  - 使用 `a-tabs` 组件
  - "入参" tab: 显示 `interceptorInputJson`
  - "回包" tab: 显示 `interceptorOutputJson`
  - JSON 数据通过 computed properties 自动格式化
  - 空状态提示: "请选择拦截器查看详情"

- ✅ 数据流
  - `lastResult.value.interceptorCalls` 存储拦截器调用记录
  - `selectedInterceptor` 跟踪当前选中的拦截器
  - `selectedInterceptorDetails` computed 自动查找选中的拦截器数据
  - JSON 格式化通过 `formatJSON()` 函数

**需要优化的部分**:
- 🔄 视觉设计可能需要针对演示场景微调
- 🔄 验证 JSON 格式化是否足够清晰
- 🔄 验证空状态和错误处理

## 变更内容

### 规范变更

- **ADDED**: Mock 面板拦截器列表 UI 增强
  - 优化列表项布局,提升视觉层次
  - 增强选中状态和 hover 效果
  - 保持序号徽章、名称、时间戳的展示

- **ADDED**: 拦截器详情 Tabs 视图验证
  - 验证入参 tab 的 JSON 展示
  - 验证回包 tab 的 JSON 展示
  - 确保 Tabs 切换流畅
  - 优化空状态和占位符文案

- **ADDED**: 演示场景准备
  - 创建示例工作流 BPMN 文件
  - 准备拦截器调用的测试用例
  - 验证数据从 API 响应到 UI 展示的完整流程

### 代码变更

- **MODIFIED**: `client/src/components/MockControlPanel.vue`
  - 优化拦截器列表项样式(如果需要)
  - 验证和优化 JSON 格式化逻辑
  - 增强空状态提示
  - 微调 Tabs 样式以更适合演示

- **ADDED**: 测试用例和示例数据
  - 创建演示用的 BPMN 工作流
  - 准备包含拦截器调用的 mock 响应数据
  - 验证 UI 组件在不同数据状态下的表现

## 影响

- **受影响的规范**:
  - `workflow-editor` - 新增拦截器详情视图需求

- **受影响的代码**:
  - `client/src/components/MockControlPanel.vue` - UI 优化和验证
  - 可能需要新增演示用的测试文件或数据文件

- **兼容性影响**:
  - 非破坏性变更,只是 UI 优化和完善
  - 不影响现有 API 和数据结构

- **性能影响**:
  - 无显著性能影响
  - JSON 格式化在前端进行,数据量较小

## 风险

- **实施风险**:
  - 低 - 主要是 UI 优化和验证工作
  - 需要仔细测试不同数据状态(空列表、单条记录、多条记录)

- **用户体验风险**:
  - 低 - 只是增强和优化,不改变核心交互

## 验收标准

1. **列表展示**:
   - [ ] 拦截器列表以清晰的列表形式展示
   - [ ] 每个列表项显示序号、名称、时间戳
   - [ ] 列表项可点击,点击后高亮显示
   - [ ] 模式切换控件(记录/Mock/禁用)正常工作

2. **详情展示**:
   - [ ] 点击列表项后,下方详情区域显示对应数据
   - [ ] 详情使用 Tabs 切换,包含"入参"和"回包"两个 tab
   - [ ] 入参 tab 显示格式化的 JSON 数据
   - [ ] 回包 tab 显示格式化的 JSON 数据
   - [ ] JSON 数据清晰易读,缩进正确

3. **交互反馈**:
   - [ ] 未选择拦截器时,显示"请选择拦截器查看详情"提示
   - [ ] 列表项 hover 时有视觉反馈
   - [ ] 选中的列表项有明显的高亮效果

4. **演示场景**:
   - [ ] 可以执行示例工作流并产生拦截器调用
   - [ ] 拦截器调用在列表中正确显示
   - [ ] 可以点击查看任意拦截器的详情
   - [ ] 整个流程流畅,适合演示展示

## 时间估算

| Phase | 任务数 | 预计时间 | 实际时间 | 依赖 |
|-------|-------|---------|---------|------|
| Phase 1: UI 验证和优化 | 4 | 0.5-1 天 | - | 无 |
| Phase 2: 演示场景准备 | 3 | 0.5-1 天 | - | Phase 1 |
| Phase 3: 测试和文档 | 2 | 0.5 天 | - | Phase 2 |
| **总计** | **9** | **1.5-2.5 天** | - | - |

## 替代方案

1. **使用表格布局代替列表**:
   - 优点: 可以显示更多列信息
   - 缺点: 在当前面板宽度下可能拥挤,不够简洁
   - 决策: 保持列表布局,更适合当前面板尺寸

2. **使用抽屉(Drawer)展示详情**:
   - 优点: 可以提供更大的展示空间
   - 缺点: 需要额外的交互步骤,不够直观
   - 决策: 保持分屏布局,详情始终可见

3. **使用代码编辑器组件代替 textarea**:
   - 优点: 更专业的 JSON 展示,支持语法高亮
   - 缺点: 引入额外依赖,增加复杂度
   - 决策: 演示场景下 textarea 足够,保持简单

## 后续工作

本次变更完成后,未来可以考虑:

1. 添加 JSON 编辑功能,允许修改 mock 数据
2. 添加复制到剪贴板功能
3. 支持拦截器调用的时序图展示
4. 支持拦截器调用的搜索和过滤
5. 持久化拦截器记录到后端数据库(已在 refactor-interceptor-invocation 中规划)
