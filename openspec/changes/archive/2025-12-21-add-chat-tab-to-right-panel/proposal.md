# 提案: 将 AI 聊天界面集成到右侧面板

## 概述

当前 BPMN 编辑器中的 AI 聊天界面以浮动窗口形式独立显示,与已经统一的右侧面板布局不一致。为了提供更加统一和现代化的用户体验,需要将 AI 聊天界面集成到右侧面板作为第二个 Tab。

当前状态:
- 右侧面板已通过 `unify-editor-right-panel` 变更统一了 Properties、Mock、Debug、Interceptor 四个面板
- AI 聊天界面 (`ChatBox.vue`) 仍作为浮动窗口独立显示
- 顶部工具栏有独立的客服按钮用于打开/关闭聊天窗口

## 目标

1. **集成 AI 聊天到右侧面板**: 将 `ChatBox.vue` 组件集成为 `RightPanelContainer` 的第二个 Tab
2. **移除重复按钮**: 删除顶部工具栏的客服按钮和右下角的浮动客服按钮
3. **保持功能完整性**: 确保聊天历史加载、会话管理等功能正常工作
4. **统一用户体验**: 与其他面板保持一致的交互方式和视觉设计

## 业务价值

- **统一界面布局**: 所有辅助功能面板集中在右侧,提供一致的用户体验
- **减少视觉干扰**: 消除浮动窗口,避免遮挡主编辑区域
- **简化操作流程**: 用户通过统一的 Tab 切换访问所有功能
- **提升空间利用率**: 充分利用右侧固定区域,优化屏幕空间

## 范围

### 包含
- 将 `ChatBox.vue` 适配为 Tab 面板组件
- 在 `RightPanelContainer` 中添加 "AI 助手" Tab(第二个位置)
- 移除 `BpmnEditorPage.vue` 中的客服浮动按钮和顶部工具栏按钮
- 调整聊天组件样式以适配 Tab 容器
- 更新聊天历史加载逻辑以适配新的挂载方式

### 不包含
- 聊天功能本身的修改(会话管理、消息发送等)
- AI 对话能力的增强
- 其他右侧面板 Tab 的功能变更

## 依赖项

- 依赖变更: `unify-editor-right-panel` (必须已完成)
- 组件: `ChatBox.vue`, `RightPanelContainer.vue`, `BpmnEditorPage.vue`
- 服务: `claudeLlmService.ts`, `chatApiService.ts`

## 风险评估

### 技术风险
- **聊天历史加载时机**: 由浮动窗口改为 Tab 后,组件挂载时机可能变化,需要确保历史加载逻辑正确
- **组件状态保持**: 使用 `<keep-alive>` 时需要确保聊天状态(消息、会话ID等)不会丢失
- **布局适配**: 聊天组件从固定尺寸浮动窗口改为自适应 Tab 容器,需要调整样式

### 缓解措施
- 使用 `<keep-alive>` 包裹聊天组件,保持状态
- 在 Tab 激活时触发历史加载逻辑
- 充分测试 Tab 切换场景下的状态保持
- 保留聊天组件的核心逻辑不变,仅调整布局相关代码

## 成功标准

1. AI 聊天 Tab 在右侧面板第二个位置正确显示
2. 点击 AI 聊天 Tab 能正常加载聊天历史
3. 聊天功能(发送消息、接收回复、会话管理)完全正常
4. Tab 切换时聊天状态不会丢失
5. 顶部工具栏和右下角不再有独立的客服按钮
6. 聊天界面样式适配 Tab 容器,无溢出或错位
