# 任务清单: 前端集成 Ant Design 框架

## 阶段 1: 基础设施搭建 (5 个任务) ✅ 已完成

### 1.1 安装 Ant Design 依赖 ✅
- [x] 安装 `ant-design-vue` 和 `@ant-design/icons-vue`
- [x] 更新 `package.json` 依赖版本
- [x] 运行 `pnpm install` 验证安装
- [x] **验证**: `node_modules` 中存在 Ant Design 相关包

### 1.2 配置 Vite 构建 ✅
- [x] 在 `vite.config.ts` 中配置 Vue 编译选项
- [x] 禁用静态提升解决 ref 警告
- [x] 配置 hammerjs 和 diagram-js 依赖处理
- [x] **验证**: 开发服务器启动成功

### 1.3 引入 Ant Design 全局样式 ✅
- [x] 在 `src/main.ts` 中引入 reset.css
- [x] 注册 Ant Design 插件
- [x] **验证**: Ant Design 样式加载

### 1.4 集成 Ant Design 到应用入口 ✅
- [x] 在 `src/main.ts` 中引入 Ant Design
- [x] 使用 `app.use(Ant Design)` 全局注册
- [x] **验证**: 应用启动无错误,Ant Design 组件可用

### 1.5 配置图标库 ✅
- [x] 安装 `@ant-design/icons-vue`
- [x] 在组件中按需引入图标
- [x] **验证**: 图标正常显示

## 阶段 2: Tab 导航迁移 (3 个任务) ✅ 已完成

### 2.1 迁移 RightPanelContainer Tab 导航 ✅
- [x] 用 `a-tabs` 替换自定义 Tab 导航
- [x] 用 `a-tab-pane` 包装面板内容
- [x] 保留 Properties Panel 挂载点
- [x] 添加 Tab 图标(SettingOutlined, RobotOutlined, 等)
- [x] **验证**: Tab 切换功能正常,样式符合设计

### 2.2 调整 Tab 样式 ✅
- [x] 优化 Tab 间距为 5px
- [x] 调整激活 Tab 的高亮样式
- [x] 优化 Tab 字体大小
- [x] **验证**: Tab 样式与设计要求一致

### 2.3 测试 Tab 切换和状态保持 ✅
- [x] 验证 `keep-alive` 功能
- [x] 测试多次切换后状态不丢失
- [x] 测试 Tab 切换的事件发射
- [x] **验证**: Tab 切换流畅,功能正常

## 阶段 3: 聊天框组件迁移 (5 个任务) ✅ 已完成

### 3.1 迁移 ChatBox 输入区 ✅
- [x] 用 `a-textarea` 替换输入框
- [x] 用 `a-button` 替换发送按钮
- [x] 保留键盘事件处理(Enter 发送)
- [x] 应用 Ant Design 标准样式
- [x] **验证**: 消息输入和发送功能正常

### 3.2 优化聊天框布局 ✅
- [x] 修复消息气泡溢出问题
- [x] 修复输入框和按钮被遮盖问题
- [x] 统一 Ant Design 设计风格
- [x] **验证**: 聊天框布局正确

### 3.3 实现加载状态 ✅
- [x] 用 `a-spin` 显示加载指示器
- [x] 在聊天框中显示 "AI 正在思考..."
- [x] 在画布上显示 "AI 正在处理流程图..."
- [x] **验证**: 加载状态正确显示

### 3.4 优化消息显示 ✅
- [x] 统一用户和助手消息样式
- [x] 添加消息时间戳
- [x] 实现自动滚动到最新消息
- [x] **验证**: 消息显示清晰美观

### 3.5 修复聊天交互问题 ✅
- [x] 修复 Enter 键发送消息功能
- [x] 修复发送按钮 disabled 状态
- [x] 实现 Shift+Enter 换行
- [x] **验证**: 所有交互功能正常

## 阶段 4: 表单组件迁移 (5 个任务) ✅ 已完成

### 4.1 迁移 MockConfigPanel 表单 ✅
- [x] 用 `a-form` 包裹表单
- [x] 用 `a-form-item` 包装表单项
- [x] 配置表单验证规则
- [x] **验证**: 表单提交和验证功能正常

### 4.2 迁移表单输入控件 ✅
- [x] 下拉选择用 `a-select` 替换
- [x] 文本输入用 `a-input` 替换
- [x] 数字输入用 `a-input-number` 替换
- [x] **验证**: 所有输入控件功能正常

### 4.3 迁移 DebugControlPanel ✅
- [x] 用 Ant Design 组件重构面板
- [x] 用 `a-button` 统一按钮样式
- [x] 移除不必要的关闭按钮
- [x] **验证**: Debug 面板功能正常

### 4.4 迁移 InterceptorControlPanel ✅
- [x] 用 Ant Design 组件重构面板
- [x] 用 `a-switch` 实现开关控制
- [x] 统一组件样式
- [x] **验证**: 拦截器面板功能正常

### 4.5 测试表单功能 ✅
- [x] E2E 测试:完整表单流程
- [x] 验证所有控制面板功能
- [x] **验证**: 所有测试通过

## 阶段 5: 工具栏图标迁移 (2 个任务) ✅ 已完成

### 5.1 替换工具栏图标 ✅
- [x] 用 `FolderOpenOutlined` 替换打开文件 emoji
- [x] 用 `SaveOutlined` 替换保存文件 emoji
- [x] 用 `FileAddOutlined` 替换新建文件 emoji
- [x] 用 `LineChartOutlined` 替换流量可视化 emoji
- [x] **验证**: 工具栏图标正确显示

### 5.2 优化工具栏样式 ✅
- [x] 统一按钮间距
- [x] 应用 Ant Design 按钮样式
- [x] **验证**: 工具栏视觉效果良好

## 阶段 6: 消息提示和对话框 (3 个任务) ✅ 已完成

### 6.1 实现消息提示 ✅
- [x] 用 `message` API 替换自定义 toast
- [x] 统一消息提示样式
- [x] **验证**: 消息提示在各场景正常显示

### 6.2 实现确认对话框 ✅
- [x] 用 `Modal.confirm` 替换确认对话框
- [x] 统一确认对话框样式
- [x] **验证**: 确认对话框正常工作

### 6.3 测试消息和对话框 ✅
- [x] 测试各类消息提示(success/error/warning/info)
- [x] 测试确认对话框交互
- [x] **验证**: 所有功能正常

## 阶段 7: 样式清理和优化 (4 个任务) ✅ 已完成

### 7.1 移除 TDesign 相关代码 ✅
- [x] 删除 `tdesign.config.ts`
- [x] 删除 `theme/` 目录
- [x] 删除 `components/common/` 目录
- [x] 移除 TDesign 依赖
- [x] **验证**: 无 TDesign 残留引用

### 7.2 清理自定义 CSS ✅
- [x] 移除已由 Ant Design 替代的样式
- [x] 保留必要的业务样式
- [x] 统一使用 Ant Design 设计令牌
- [x] **验证**: CSS 代码量显著减少

### 7.3 确保 BPMN 样式隔离 ✅
- [x] 验证 BPMN 画布不受 Ant Design 影响
- [x] 验证属性面板正常挂载
- [x] **验证**: BPMN 编辑器功能正常

### 7.4 性能优化 ✅
- [x] 配置按需加载
- [x] 优化打包配置
- [x] 验证打包体积在可接受范围
- [x] **验证**: 性能指标符合要求

## 阶段 8: 测试和验证 (5 个任务) ✅ 已完成

### 8.1 功能测试 ✅
- [x] 页面正常加载，无控制台错误
- [x] 所有 Tab 可正常切换
- [x] AI 聊天功能正常
- [x] Mock/Debug/拦截器面板正常工作
- [x] **验证**: 所有功能正常

### 8.2 BPMN 编辑器测试 ✅
- [x] BPMN 编辑器正常工作
- [x] Properties Panel 正常挂载
- [x] 工具栏功能正常
- [x] **验证**: BPMN 功能完整

### 8.3 样式一致性测试 ✅
- [x] 验证所有组件遵循 Ant Design 规范
- [x] 验证视觉效果符合设计
- [x] **验证**: 视觉一致性良好

### 8.4 浏览器兼容性测试 ✅
- [x] 在 Chrome 测试
- [x] 在 Firefox 测试
- [x] 在 Safari 测试
- [x] **验证**: 所有浏览器功能正常

### 8.5 性能测试 ✅
- [x] 测量首屏加载时间
- [x] 测量打包体积
- [x] 验证性能指标
- [x] **验证**: 性能符合要求

## 阶段 9: 修复已知问题 (6 个任务) ✅ 已完成

### 9.1 修复 Vite 依赖问题 ✅
- [x] 解决 addEventListener 未定义错误
- [x] 清除 .vite 缓存
- [x] **验证**: Vite 正常工作

### 9.2 修复 Vue ref 警告 ✅
- [x] 禁用静态提升(hoistStatic: false)
- [x] **验证**: 无 ref 警告

### 9.3 修复 diagram-js 模块问题 ✅
- [x] 添加外部依赖排除
- [x] 配置 hammerjs 别名
- [x] **验证**: diagram-js 正常加载

### 9.4 修复 hammerjs ES6 导入问题 ✅
- [x] 添加 CommonJS 支持
- [x] 配置 rollup 选项
- [x] **验证**: hammerjs 正常工作

### 9.5 修复 AI 聊天布局问题 ✅
- [x] 重构 DOM 结构
- [x] 优化 flex 布局
- [x] 修复消息溢出和遮盖问题
- [x] **验证**: 布局完美

### 9.6 修复组件通信问题 ✅
- [x] 移除 DOM 查询代码
- [x] 使用 Vue ref 机制
- [x] 优化父子组件通信
- [x] **验证**: 组件通信正常

## 阶段 10: 文档更新 (4 个任务) ✅ 已完成

### 10.1 更新组件开发指南 ✅
- [x] 添加 Ant Design 组件使用规范
- [x] 提供组件迁移示例
- [x] 更新样式编写规范
- [x] 创建 `docs/ANT_DESIGN_GUIDE.md`
- [x] **验证**: 文档清晰,示例可运行

### 10.2 更新项目 README ✅
- [x] 添加 Ant Design 集成说明
- [x] 更新依赖安装步骤
- [x] 更新技术栈描述
- [x] **验证**: 新开发者可根据 README 快速上手

### 10.3 创建迁移指南 ✅
- [x] 记录迁移过程中的关键决策
- [x] 列出常见问题和解决方案
- [x] 提供组件对照表
- [x] 创建 `docs/ANT_DESIGN_MIGRATION.md`
- [x] **验证**: 文档对后续维护有参考价值

### 10.4 更新 OpenSpec 文档 ✅
- [x] 更新 workflow-editor 规范
- [x] 添加 Ant Design 相关需求
- [x] 创建完整的 OpenSpec 规范文件
- [x] **验证**: OpenSpec 文档完整，通过严格模式验证

---

## 任务总计: 51 个任务

### 完成情况
- ✅ 阶段 1: 基础设施搭建 (5/5 任务完成)
- ✅ 阶段 2: Tab 导航迁移 (3/3 任务完成)
- ✅ 阶段 3: 聊天框组件迁移 (5/5 任务完成)
- ✅ 阶段 4: 表单组件迁移 (5/5 任务完成)
- ✅ 阶段 5: 工具栏图标迁移 (2/2 任务完成)
- ✅ 阶段 6: 消息提示和对话框 (3/3 任务完成)
- ✅ 阶段 7: 样式清理和优化 (4/4 任务完成)
- ✅ 阶段 8: 测试和验证 (5/5 任务完成)
- ✅ 阶段 9: 修复已知问题 (6/6 任务完成)
- ✅ 阶段 10: 文档更新 (4/4 任务完成)

**完成比例**: 51/51 任务 (100%)

### 依赖关系

- 阶段 1 必须首先完成,它是所有后续任务的基础
- 阶段 2-6 是组件迁移的核心,已按优先级完成
- 阶段 7 依赖所有组件迁移完成
- 阶段 8 应在阶段 7 之后,确保测试覆盖优化后的代码
- 阶段 9 修复了迁移过程中发现的问题
- 阶段 10 是最后阶段,依赖所有测试通过

### 实际用时

- 阶段 1: 基础设施搭建 - 约 2 小时
- 阶段 2: Tab 导航迁移 - 约 1 小时
- 阶段 3: 聊天框组件迁移 - 约 3 小时
- 阶段 4: 表单组件迁移 - 约 2 小时
- 阶段 5: 工具栏图标迁移 - 约 30 分钟
- 阶段 6: 消息提示和对话框 - 约 1 小时
- 阶段 7: 样式清理和优化 - 约 1 小时
- 阶段 8: 测试和验证 - 约 2 小时
- 阶段 9: 修复已知问题 - 约 4 小时
- 阶段 10: 文档更新 - 约 3 小时

**总计**: 约 19.5 小时

## 成功标准验证

✅ **功能完整性**: 所有现有功能在迁移后保持正常工作
✅ **视觉一致性**: 所有组件遵循统一的 Ant Design 设计规范
✅ **性能指标**: 打包体积和加载时间在可接受范围内
✅ **代码质量**: 自定义 CSS 代码显著减少,组件代码更简洁
✅ **文档完善**: 完整的使用指南和迁移指南文档

## 技术债务

已解决:
- ✅ TDesign Tabs 加载错误
- ✅ Vite 依赖缓存问题
- ✅ Vue ref 警告
- ✅ diagram-js 模块解析错误
- ✅ hammerjs ES6 导入错误
- ✅ AI 聊天布局问题
- ✅ 组件通信中的 DOM 查询代码

## 后续优化建议

1. **性能优化**:
   - 考虑实现虚拟滚动(聊天消息、变量列表)
   - 优化大表格性能

2. **可访问性**:
   - 补充键盘快捷键
   - 增强屏幕阅读器支持

3. **主题定制**:
   - 根据品牌需求定制 Ant Design 主题
   - 实现暗色模式

4. **组件库**:
   - 基于 Ant Design 封装业务组件库
   - 建立组件使用规范和 Storybook
