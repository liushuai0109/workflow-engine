# 工作流编辑器规范（变更）

## ADDED Requirements

### Requirement: 工作流 Mock 执行 SHALL 支持模拟工作流执行

工作流编辑器 SHALL 支持模拟工作流执行，用于测试和验证流程逻辑，无需连接真实外部服务。

#### Scenario: 启动 Mock 执行

- **WHEN** 操作员在编辑器中点击"Mock 执行"按钮
- **THEN** 系统解析当前工作流的 BPMN XML
- **AND** 系统显示 Mock 执行控制面板
- **AND** 系统高亮显示当前执行的节点
- **AND** 系统在节点上显示执行状态（运行中、已完成、失败）

#### Scenario: 配置节点 Mock 响应

- **WHEN** 操作员在 Mock 执行前配置节点响应
- **THEN** 系统提供节点 Mock 配置面板
- **AND** 可以为每个服务任务配置 mock 响应数据
- **AND** 可以为每个网关配置分支选择（选择哪个分支路径）
- **AND** 可以配置节点执行延迟时间
- **AND** 可以配置节点执行失败场景
- **AND** Mock 配置可以保存并与工作流关联

#### Scenario: Mock 执行可视化

- **WHEN** Mock 执行进行中
- **THEN** 当前执行节点高亮显示（例如：绿色边框）
- **AND** 已完成的节点显示完成状态（例如：蓝色填充）
- **AND** 失败的节点显示错误状态（例如：红色填充）
- **AND** 执行路径的连线高亮显示
- **AND** 显示执行进度百分比

#### Scenario: Mock 执行结果查看

- **WHEN** Mock 执行完成或暂停
- **THEN** 系统显示执行结果摘要
- **AND** 显示执行的节点列表和执行时间
- **AND** 显示每个节点的输入输出数据
- **AND** 显示工作流变量最终值
- **AND** 显示执行路径（经过的节点和连线）

### Requirement: 工作流 Debug 功能 SHALL 支持调试工作流执行过程

工作流编辑器 SHALL 支持调试工作流执行过程，包括单步执行、断点、变量监控等功能。

#### Scenario: 启动 Debug 模式

- **WHEN** 操作员点击"Debug"按钮
- **THEN** 系统进入 Debug 模式
- **AND** 显示 Debug 控制面板
- **AND** 显示变量监视面板
- **AND** 显示执行历史时间线
- **AND** 当前执行节点高亮显示

#### Scenario: 单步执行

- **WHEN** 操作员在 Debug 模式下点击"单步执行"按钮
- **THEN** 系统执行下一个节点
- **AND** 执行后暂停，等待下一步操作
- **AND** 更新变量监视面板显示最新变量值
- **AND** 在执行历史中添加新记录
- **AND** 高亮显示当前暂停的节点

#### Scenario: 设置断点

- **WHEN** 操作员在节点上右键选择"设置断点"
- **THEN** 节点显示断点标记（例如：红色圆点）
- **AND** 执行到该节点时自动暂停
- **AND** 显示当前执行上下文（变量、调用栈）
- **AND** 操作员可以继续执行或单步执行

#### Scenario: 查看变量值

- **WHEN** 操作员在 Debug 模式下查看变量
- **THEN** 变量监视面板显示所有工作流变量
- **AND** 显示变量的名称、类型、当前值
- **AND** 变量值可以展开查看复杂对象
- **AND** 变量值变化时高亮显示
- **AND** 支持搜索和过滤变量

#### Scenario: 查看节点输入输出

- **WHEN** 操作员在 Debug 模式下选择已执行的节点
- **THEN** 系统显示该节点的输入数据
- **AND** 系统显示该节点的输出数据
- **AND** 系统显示节点的执行时间
- **AND** 如果节点失败，显示错误信息

#### Scenario: 执行历史时间线

- **WHEN** 操作员查看执行历史
- **THEN** 系统显示按时间顺序的执行记录
- **AND** 每条记录包含：节点ID、节点名称、执行时间、状态、输入输出
- **AND** 可以点击历史记录跳转到对应节点
- **AND** 支持过滤和搜索历史记录

#### Scenario: Debug 控制操作

- **WHEN** 操作员使用 Debug 控制按钮
- **THEN** "开始"按钮启动 Debug 执行
- **AND** "暂停"按钮暂停当前执行
- **AND** "继续"按钮从暂停点继续执行
- **AND** "停止"按钮终止 Debug 执行
- **AND** "单步执行"按钮执行下一个节点后暂停
- **AND** "单步跳过"按钮跳过当前节点（如果可能）

### Requirement: Mock 配置管理 SHALL 支持保存、加载和管理 Mock 配置

工作流编辑器 SHALL 支持保存、加载和管理 Mock 配置。

#### Scenario: 保存 Mock 配置

- **WHEN** 操作员配置完节点 Mock 响应后点击"保存配置"
- **THEN** 系统将 Mock 配置保存到后端
- **AND** Mock 配置与工作流 ID 关联
- **AND** 可以为同一工作流保存多个 Mock 配置（命名）
- **AND** 保存成功后显示提示信息

#### Scenario: 加载 Mock 配置

- **WHEN** 操作员点击"加载配置"
- **THEN** 系统显示该工作流的 Mock 配置列表
- **AND** 操作员可以选择一个配置加载
- **AND** 加载后节点 Mock 设置自动填充
- **AND** 如果配置不存在，显示空配置

#### Scenario: 导入导出 Mock 配置

- **WHEN** 操作员选择"导出配置"
- **THEN** 系统将当前 Mock 配置导出为 JSON 文件
- **AND** 导出的 JSON 包含所有节点配置
- **WHEN** 操作员选择"导入配置"
- **THEN** 系统支持从 JSON 文件导入 Mock 配置
- **AND** 导入后验证配置格式
- **AND** 导入成功后应用配置

