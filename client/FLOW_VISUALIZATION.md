# æµé‡å¯è§†åŒ–åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç”¨äº XPMN æµç¨‹å›¾çš„æµé‡å¯è§†åŒ–æ¼”ç¤ºåŠŸèƒ½ï¼Œå¯ä»¥ä»èµ·å§‹äº‹ä»¶å¼€å§‹ï¼Œä»¥è¿çº¿ç²—ç»†å’Œé¢œè‰²ä»£è¡¨æµé‡å¤§å°ï¼Œç±»ä¼¼æ¡‘åŸºå›¾çš„æ•ˆæœã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. å¯ç”¨æµé‡å¯è§†åŒ–

1. åœ¨ XPMN Explorer ä¸­æ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ªæµç¨‹å›¾
2. ç‚¹å‡»å·¥å…·æ ä¸­çš„ **"ğŸ“Š æ˜¾ç¤ºæµé‡"** æŒ‰é’®
3. ç³»ç»Ÿä¼šè‡ªåŠ¨ä»èµ·å§‹äº‹ä»¶å¼€å§‹æ¨¡æ‹Ÿæµé‡åˆ†é…
4. è¿çº¿ä¼šæ ¹æ®æµé‡å¤§å°æ˜¾ç¤ºä¸åŒçš„ç²—ç»†å’Œé¢œè‰²

### 2. å…³é—­æµé‡å¯è§†åŒ–

- å†æ¬¡ç‚¹å‡»å·¥å…·æ ä¸­çš„æŒ‰é’®ï¼ˆæ­¤æ—¶æ˜¾ç¤ºä¸º **"ğŸ“Š å…³é—­æµé‡"**ï¼‰
- è¿çº¿ä¼šæ¢å¤ä¸ºé»˜è®¤æ ·å¼

## æµé‡å¯è§†åŒ–æ•ˆæœ

### è¿çº¿ç²—ç»†
- **æœ€ç»†**: 2pxï¼ˆä½æµé‡ï¼‰
- **æœ€ç²—**: 20pxï¼ˆé«˜æµé‡ï¼‰
- ç²—ç»†ä¸æµé‡æˆæ­£æ¯”

### é¢œè‰²æ¸å˜
æµé‡ä»ä½åˆ°é«˜ï¼Œé¢œè‰²ä¼šå‘ç”Ÿæ¸å˜ï¼š
- ğŸ”µ è“è‰² (0-20%): ä½æµé‡
- ğŸŸ¢ ç»¿è‰² (20-40%): ä¸­ä½æµé‡
- ğŸŸ¡ é»„è‰² (40-60%): ä¸­ç­‰æµé‡
- ğŸŸ  æ©™è‰² (60-80%): ä¸­é«˜æµé‡
- ğŸ”´ çº¢è‰² (80-100%): é«˜æµé‡

### æµé‡æ ‡ç­¾
- åœ¨æ¯æ¡è¿çº¿çš„ä¸­ç‚¹ä½ç½®æ˜¾ç¤ºå…·ä½“çš„æµé‡æ•°å€¼
- å¸¦æœ‰ç™½è‰²åŠé€æ˜èƒŒæ™¯ï¼Œæ–¹ä¾¿æŸ¥çœ‹

## æµé‡åˆ†é…è§„åˆ™

### 1. èµ·å§‹äº‹ä»¶ï¼ˆStart Eventï¼‰
- åˆå§‹æµé‡é»˜è®¤ä¸º **100**
- å¦‚æœæœ‰å¤šä¸ªèµ·å§‹äº‹ä»¶ï¼Œæ¯ä¸ªéƒ½ä¼šäº§ç”Ÿç‹¬ç«‹çš„æµé‡

### 2. æ™®é€šèŠ‚ç‚¹ï¼ˆTask/Activityï¼‰
- æµé‡å®Œæ•´ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
- å¦‚æœæœ‰å¤šä¸ªå‡ºè¾¹ï¼Œå¹³å‡åˆ†é…

### 3. å¹¶è¡Œç½‘å…³ï¼ˆParallel Gatewayï¼‰
- æµé‡**å¤åˆ¶**åˆ°æ¯ä¸ªåˆ†æ”¯
- æ¯ä¸ªåˆ†æ”¯éƒ½è·å¾—å®Œæ•´çš„æµé‡
- ç¤ºä¾‹ï¼šå…¥æµé‡100 â†’ 3ä¸ªåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯æµé‡éƒ½æ˜¯100

### 4. æ’ä»–ç½‘å…³ï¼ˆExclusive Gatewayï¼‰
- æµé‡**åˆ†é…**åˆ°ä¸åŒåˆ†æ”¯
- é»˜è®¤å¹³å‡åˆ†é…
- ç¤ºä¾‹ï¼šå…¥æµé‡100 â†’ 3ä¸ªåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯çº¦33.3

### 5. åŒ…å®¹ç½‘å…³ï¼ˆInclusive Gatewayï¼‰
- æµé‡**åˆ†é…**åˆ°é€‰ä¸­çš„åˆ†æ”¯
- é»˜è®¤å¹³å‡åˆ†é…
- è¡Œä¸ºç±»ä¼¼æ’ä»–ç½‘å…³

### 6. åŸºäºäº‹ä»¶çš„ç½‘å…³ï¼ˆEvent-based Gatewayï¼‰
- æµé‡**åˆ†é…**åˆ°ä¸åŒäº‹ä»¶è·¯å¾„
- é»˜è®¤å¹³å‡åˆ†é…

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ–‡ä»¶

```
src/extensions/flow/
â”œâ”€â”€ FlowRenderer.ts           # æµé‡å¯è§†åŒ–æ¸²æŸ“å™¨
â”œâ”€â”€ FlowSimulator.ts          # æµé‡æ•°æ®æ¨¡æ‹Ÿå™¨
â”œâ”€â”€ FlowVisualizationModule.ts # æ‰©å±•æ¨¡å—
â””â”€â”€ index.ts                   # å¯¼å‡ºå…¥å£
```

### é›†æˆæ–¹å¼

1. **FlowRenderer**: ç»§æ‰¿è‡ª `diagram-js` çš„ `BaseRenderer`ï¼Œè´Ÿè´£ç»˜åˆ¶ä¸åŒç²—ç»†å’Œé¢œè‰²çš„è¿çº¿
2. **FlowSimulator**: ä»èµ·å§‹äº‹ä»¶å¼€å§‹é€’å½’éå†æµç¨‹ï¼Œæ ¹æ®ç½‘å…³ç±»å‹è®¡ç®—æ¯æ¡è¿çº¿çš„æµé‡
3. **FlowVisualizationModule**: å°†æ¸²æŸ“å™¨æ³¨å†Œåˆ° bpmn-js çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿ

### åœ¨ BpmnEditor ä¸­çš„é›†æˆ

```typescript
// å¯¼å…¥æ¨¡å—
import FlowVisualizationModule from '../extensions/flow/FlowVisualizationModule'
import FlowSimulator from '../extensions/flow/FlowSimulator'

// æ·»åŠ åˆ° BpmnModeler
modeler = new BpmnModeler({
  additionalModules: [
    // ... å…¶ä»–æ¨¡å—
    FlowVisualizationModule,  // æ·»åŠ æµé‡å¯è§†åŒ–æ¨¡å—
  ],
})

// å¯ç”¨/ç¦ç”¨
const enableFlowVisualization = (enabled: boolean) => {
  const flowRenderer = modeler.get('flowRenderer')
  flowRenderer.setEnabled(enabled)

  if (enabled) {
    simulateFlow()
  }
}
```

## è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹åˆå§‹æµé‡å€¼

ç¼–è¾‘ `BpmnEditor.vue` ä¸­çš„ `simulateFlow` æ–¹æ³•ï¼š

```typescript
const simulateFlow = (initialFlow: number = 100): void => {
  // ä¿®æ”¹è¿™é‡Œçš„é»˜è®¤å€¼ï¼Œä¾‹å¦‚æ”¹ä¸º 1000
  const simulator = new FlowSimulator(elementRegistry)
  simulator.setInitialFlow(1000) // è‡ªå®šä¹‰åˆå§‹æµé‡
}
```

### ä¿®æ”¹è¿çº¿ç²—ç»†èŒƒå›´

ç¼–è¾‘ `FlowRenderer.ts`:

```typescript
private minStrokeWidth: number = 2   // æœ€å°ç²—ç»†
private maxStrokeWidth: number = 20  // æœ€å¤§ç²—ç»†
```

### è‡ªå®šä¹‰é¢œè‰²æ¸å˜

ç¼–è¾‘ `FlowRenderer.ts` çš„ `calculateColor` æ–¹æ³•ï¼š

```typescript
private calculateColor(flowValue: number): string {
  const normalized = flowValue / this.maxFlow

  // è‡ªå®šä¹‰é¢œè‰²æ˜ å°„
  if (normalized < 0.25) return '#your-color-1'
  if (normalized < 0.5) return '#your-color-2'
  if (normalized < 0.75) return '#your-color-3'
  return '#your-color-4'
}
```

### è‡ªå®šä¹‰ç½‘å…³åˆ†é…æ¯”ä¾‹

å¯ä»¥åœ¨è°ƒç”¨ `simulator.simulate()` æ—¶ä¼ å…¥è‡ªå®šä¹‰åˆ†é…ï¼š

```typescript
const customDistribution: GatewayDistribution = {
  'Gateway_1': {
    'Flow_A': 0.7,  // 70% æµé‡èµ°è¿™æ¡è·¯å¾„
    'Flow_B': 0.3,  // 30% æµé‡èµ°è¿™æ¡è·¯å¾„
  }
}

const flowData = simulator.simulate(customDistribution)
```

## æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½**: å¤§å‹æµç¨‹å›¾ï¼ˆè¶…è¿‡100ä¸ªèŠ‚ç‚¹ï¼‰å¯èƒ½ä¼šæœ‰è½»å¾®çš„æ¸²æŸ“å»¶è¿Ÿ
2. **å¾ªç¯æµç¨‹**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é¿å…æ— é™å¾ªç¯
3. **Mock æ•°æ®**: å½“å‰ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„æµé‡ç»Ÿè®¡æ•°æ®
4. **æµè§ˆå™¨å…¼å®¹æ€§**: éœ€è¦æ”¯æŒ SVG çš„ç°ä»£æµè§ˆå™¨

## ç¤ºä¾‹åœºæ™¯

### ä¸šåŠ¡æµç¨‹åˆ†æ
- å¯è§†åŒ–å®¢æˆ·åœ¨ä¸åŒè·¯å¾„çš„åˆ†å¸ƒ
- è¯†åˆ«ä¸šåŠ¡ç“¶é¢ˆ
- ä¼˜åŒ–æµç¨‹è®¾è®¡

### ç³»ç»Ÿæ¶æ„å¯è§†åŒ–
- å±•ç¤ºè¯·æ±‚åœ¨ä¸åŒæœåŠ¡é—´çš„æµé‡
- è¯†åˆ«é«˜è´Ÿè½½è·¯å¾„
- å®¹é‡è§„åˆ’å‚è€ƒ

### å†³ç­–æ ‘åˆ†æ
- æ˜¾ç¤ºä¸åŒå†³ç­–åˆ†æ”¯çš„é€‰æ‹©æ¦‚ç‡
- å¸®åŠ©ä¼˜åŒ–å†³ç­–è§„åˆ™

## æœªæ¥æ‰©å±•

å¯èƒ½çš„æ‰©å±•æ–¹å‘ï¼š

1. **å®æ—¶æ•°æ®å¯¹æ¥**: è¿æ¥åˆ°å®é™…çš„æµç¨‹æ‰§è¡Œå¼•æ“ï¼Œæ˜¾ç¤ºçœŸå®æµé‡
2. **æ—¶é—´è½´å›æ”¾**: æ”¯æŒæŸ¥çœ‹ä¸åŒæ—¶é—´æ®µçš„æµé‡å˜åŒ–
3. **çƒ­åŠ›å›¾æ¨¡å¼**: é™¤äº†è¿çº¿ï¼Œè¿˜å¯ä»¥å¯¹èŠ‚ç‚¹è¿›è¡Œæµé‡æŸ“è‰²
4. **æµé‡ç»Ÿè®¡é¢æ¿**: æ˜¾ç¤ºè¯¦ç»†çš„æµé‡ç»Ÿè®¡æ•°æ®
5. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºæµé‡å¯è§†åŒ–ä¸ºå›¾ç‰‡æˆ–PDF

## é—®é¢˜åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·åœ¨é¡¹ç›® Issues ä¸­åé¦ˆã€‚

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-06
**ç‰ˆæœ¬**: 1.0.0
