# BPMN Explorer

基于 bpmn-js 构建的现代 BPMN 图表编辑器，从 demo.bpmn.io 的功能分支而来。

## 功能特性

- **创建和编辑 BPMN 图表**：功能完整的 BPMN 2.0 图表编辑器
- **文件操作**：从本地文件打开和保存 BPMN 图表
- **自动保存**：自动将编辑内容保存到本地存储，防止数据丢失
- **键盘快捷键**：完整的键盘快捷键支持，提高编辑效率
- **现代界面**：受 demo.bpmn.io 启发的简洁响应式界面
- **工具选择**：手形、套索、空格、追加和创建工具

## 快速开始

### 前置要求

- Node.js（版本 14 或更高）
- npm 或 yarn

### 安装

1. 克隆或下载此仓库
2. 安装依赖：
   ```bash
   npm install
   ```

### 运行应用

启动开发服务器：
```bash
npm start
```

这将在 `http://localhost:9000` 启动本地服务器并自动在浏览器中打开应用。

**注意**：应用现在直接从根目录提供服务，URL 中不会显示 `src/` 路径。

或者，您可以使用：
```bash
npm run dev
```

## 使用方法

### 创建新图表

1. 在欢迎屏幕上点击"创建新图表"，或
2. 使用键盘快捷键 `Ctrl+N`（Mac 上为 `Cmd+N`）

### 打开图表

1. 点击标题栏中的"打开"，或
2. 使用键盘快捷键 `Ctrl+O`（Mac 上为 `Cmd+O`）
3. 从本地系统选择一个 `.bpmn` 或 `.xml` 文件

### 保存图表

1. 点击标题栏中的"保存"，或
2. 使用键盘快捷键 `Ctrl+S`（Mac 上为 `Cmd+S`）
3. 图表将作为 `.bpmn` 文件下载

### 自动保存功能

BPMN Explorer 具有智能的自动保存功能：

- **自动触发**：当您编辑图表时，系统会在 2 秒后自动保存到浏览器本地存储
- **状态指示**：页面右上角会显示自动保存状态（"Auto-saved"、"Auto-save enabled" 等）
- **自动恢复**：重新打开应用时，如果有未保存的更改，会自动恢复图表
- **数据清理**：自动保存的数据会在 24 小时后自动清理
- **手动清除**：使用 `Ctrl+Shift+Delete` 快捷键可以手动清除自动保存数据

### 键盘快捷键

| 操作 | 快捷键 |
|------|--------|
| 打开图表 | `Ctrl+O` |
| 保存图表 | `Ctrl+S` |
| 撤销 | `Ctrl+Z` |
| 重做 | `Ctrl+Shift+Z` |
| 全选 | `Ctrl+A` |
| 手形工具 | `H` |
| 套索工具 | `L` |
| 空格工具 | `S` |
| 追加工具 | `A` |
| 创建工具 | `N` |
| 直接编辑 | `E` |
| 清除自动保存 | `Ctrl+Shift+Delete` |

### 工具说明

- **手形工具**：平移和导航图表
- **套索工具**：通过绘制选择区域选择多个元素
- **空格工具**：通过移动元素创建空间
- **追加工具**：添加与现有元素连接的新元素
- **创建工具**：在画布上任意位置创建新元素

## 项目结构

```
bpmn-explorer/
├── src/                # 源文件目录（服务器根目录）
│   ├── index.html      # 主 HTML 文件
│   ├── styles.css      # CSS 样式
│   ├── app.js         # JavaScript 应用逻辑
│   ├── example.bpmn   # 示例 BPMN 图表
│   └── bpmn-js-dist/   # 本地 bpmn-js 库文件
├── bpmn-js-dist/       # 原始 bpmn-js 库文件（备份）
├── node_modules/       # Node.js 依赖
├── package.json        # 项目配置和依赖
├── .gitignore         # Git 忽略规则
└── README.md          # 本文件
```

## 依赖项

- **bpmn-js**：核心 BPMN 图表库
- **http-server**：本地测试开发服务器

## 浏览器支持

此应用支持所有支持 ES6+ 功能的现代浏览器：
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 许可证

此项目采用 MIT 许可证。请注意，bpmn-js 本身采用 bpmn.io 许可证，需要归因于 bpmn.io。

## 贡献

1. Fork 仓库
2. 创建功能分支
3. 进行更改
4. 充分测试
5. 提交拉取请求

## 致谢

- 由 bpmn.io 团队使用 [bpmn-js](https://github.com/bpmn-io/bpmn-js) 构建
- 受 [demo.bpmn.io](https://demo.bpmn.io) 启发
- 图标和样式基于现代网页设计原则

## 故障排除

### 常见问题

1. **图表无法加载**：确保您的 BPMN 文件是有效的 XML 并遵循 BPMN 2.0 标准
2. **保存不工作**：检查浏览器控制台是否有错误，并确保您有下载权限
3. **键盘快捷键不工作**：确保画布有焦点（点击它）

### 获取帮助

如果遇到问题：
1. 检查浏览器控制台中的错误消息
2. 确保您的 BPMN 文件有效
3. 尝试刷新页面
4. 检查所有依赖是否正确安装

## 未来增强

- [ ] 协作编辑支持
- [ ] 云存储集成
- [ ] 自定义元素类型
- [ ] 导出为不同格式（PNG、SVG、PDF）
- [ ] 主题自定义
- [ ] 插件系统