# 生成工作日报

根据 git 提交记录和 openspec 变更记录生成指定日期的工作日报。

## 参数

- `$ARGUMENTS`: 可选，指定日期。支持多种格式输入，会自动统一转换为 YYYY-MM-DD 格式。如不提供则默认生成当天日报。

## 执行步骤

请按以下步骤生成工作日报：

### 1. 确定日期

```
输入日期: ${ARGUMENTS:-今天}
```

如果 `$ARGUMENTS` 为空，使用今天的日期。

**日期格式统一处理**：
将用户输入的日期统一转换为 `YYYY-MM-DD` 格式。支持以下输入格式：
- `YYYY-MM-DD` (如 2025-12-26) → 直接使用
- `YYYY.MM.DD` (如 2025.12.26) → 转换为 2025-12-26
- `YYYY/MM/DD` (如 2025/12/26) → 转换为 2025-12-26
- `MM-DD` (如 12-26) → 补充当前年份，转换为 2025-12-26
- `MM.DD` (如 12.26) → 补充当前年份，转换为 2025-12-26
- `MM/DD` (如 12/26) → 补充当前年份，转换为 2025-12-26

```
目标日期: {统一后的 YYYY-MM-DD 格式日期}
日报文件: 工作日报-{目标日期}.md
```

### 2. 获取 Git 提交记录

执行以下命令获取指定日期的 git 提交：

```bash
# 获取指定日期的提交记录
git log --since="{日期} 00:00:00" --until="{日期} 23:59:59" --pretty=format:"%h|%s|%an|%ad" --date=format:"%H:%M"

# 获取每个提交的详细变更
git log --since="{日期} 00:00:00" --until="{日期} 23:59:59" --stat --pretty=format:"--- COMMIT: %h ---%n%s%n%b"
```

### 3. 获取 OpenSpec 变更记录

检查 `openspec/changes/` 目录下的变更：

```bash
# 查看 openspec 变更目录
ls -la openspec/changes/

# 检查每个变更目录的修改时间和内容
# 查看 proposal.md, tasks.md 等文件的修改情况
```

对于指定日期有修改的 openspec 变更，读取其 `proposal.md` 获取变更描述。

### 4. 检查现有日报

检查是否已存在指定日期的日报文件 `工作日报-{日期}.md`：
- 如果存在：读取现有内容，准备更新
- 如果不存在：创建新日报

### 5. 生成日报内容

按以下格式生成或更新日报：

```markdown
# 工作日报 - {年}年{月}月{日}日

## 📋 工作概览

**日期**: {年}年{月}月{日}日
**主要工作**: {根据提交记录总结主要工作内容}

---

## ✅ 已完成工作

### 1. {工作项标题}（{时间}）

**任务**: {任务描述}

**完成内容**:
- ✅ {具体完成的内容1}
- ✅ {具体完成的内容2}
- ...

**Git提交**: `{commit hash}` - {commit message}

**文件变更统计**:
- 新增文件: X 个
- 修改文件: X 个
- 删除文件: X 个

---

{重复以上结构列出所有工作项}

## 📊 工作统计

### Git提交统计
- **总提交数**: X 个
- **功能提交**: X 个
- **修复提交**: X 个
- **其他提交**: X 个

### 代码变更统计
- **新增文件**: X 个
- **修改文件**: X 个
- **删除文件**: X 个

---

## 🔄 OpenSpec 变更

{如果有 openspec 变更，列出：}

### {变更名称}

**状态**: {进行中/已完成/待审核}
**描述**: {从 proposal.md 提取的变更描述}

---

## 🔍 技术细节

{如果有重要的技术实现细节，在此描述}

---

## 🔍 发现的问题

{如果有发现的问题，按以下格式列出：}

### 1. {问题标题}
- **问题**: {问题描述}
- **影响**: {影响范围}
- **解决方案**: {建议的解决方案}
- **状态**: ⚠️ 待处理 / ✅ 已解决

---

## 📝 下一步计划

### 短期
1. {计划1}
2. {计划2}

### 中期
1. {计划1}
2. {计划2}

---

## 💡 经验总结

1. {经验1}
2. {经验2}

---

## 📌 备注

{其他需要记录的内容}

---

**报告生成时间**: {当前时间}
**报告人**: AI Assistant
```

### 6. 写入文件

将生成的日报内容写入 `工作日报-{日期}.md` 文件。

### 7. 输出结果

完成后输出：
- 日报文件路径
- 包含的提交数量
- OpenSpec 变更数量
- 是新建还是更新

## 注意事项

1. 如果指定日期没有任何 git 提交和 openspec 变更，提示用户并询问是否仍要生成空白日报
2. 提交信息中的 `feat:` 归类为功能提交，`fix:` 归类为修复提交，`chore:` `docs:` 等归类为其他
3. 尽量从提交信息和文件变更中提取有意义的工作描述
4. 保持与现有日报格式一致
5. 如果是更新现有日报，保留原有内容中的手动添加部分（如经验总结、下一步计划等）
